---
categories:
- π‘©β€π’» Today I learn
- JPA
  
tags:
- JPA
---
### β…Β ν•΄κ²° λ°©λ²•

---

- API
    - λ“±λ΅: `POST` /books/{bookId}/reviews
- `review` entityμ `bookId`μ— νλΌλ―Έν„°λ΅ λ„μ–΄μ¨ `bookId` μ„ λ„£μ–΄μ•Ό ν•λ” μƒν™©μ΄μ—λ‹¤.
- λ„μ–΄μ¨ bookId νλΌλ―Έν„°λ΅ `book` entityλ¥Ό μ°Ύμ•„μ„ κ°μ²΄μ— μ €μ¥μ‹ν‚¨λ‹¤μ ν•΄λ‹Ή κ°μ²΄ μμ²΄λ¥Ό λ„£μΌλ©΄ λλ‹¤.
- λ”°λ΅ bookIdλ¥Ό λ„£μ§€ μ•μ•„λ„ κ°μ²΄ μμ²΄λ¥Ό μ €μ¥μ‹ν‚¤λ©΄ μ™Έλ ν‚¤ κ΄€κ³„λ¥Ό μλ™μΌλ΅ μ—°κ²°μ‹μΌμ¤€λ‹¤.
    - μ¦‰, `Review` μ—”ν‹°ν‹°μ `book` ν•„λ“μ— `Book` κ°μ²΄λ¥Ό μ„¤μ •ν•λ©΄, JPAκ°€ μλ™μΌλ΅ `Review` ν…μ΄λΈ”μ μ™Έλ ν‚¤(`bookId`) μ»¬λΌμ— ν•΄λ‹Ή `Book`μ `id`λ¥Ό μ €μ¥ν•΄ μ¤

### π“Β Review Service

```java
public boolean postReview(Long bookId, Review review){

    // λ„μ–΄μ¨ νλΌλ―Έν„° bookIdλ΅ Book μ—”ν‹°ν‹° κ°μ²΄ μ°ΎκΈ°
    Optional<Book> book = bookService.getBookById(bookId);
    
    // Book μ—”ν‹°ν‹° κ°μ²΄κ°€ μ΅΄μ¬ν•μ§€ μ•λ”λ‹¤λ©΄ false λ°ν™
    if (book.isEmpty()) { return false; }
    
    // μ°Ύμ€ Book μ—”ν‹°ν‹° κ°μ²΄λ¥Ό Review μ—”ν‹°ν‹°μ book ν•„λ“μ— μ„¤μ •
    review.setBook(book.get());
    
    // Review μ—”ν‹°ν‹° μ €μ¥
    reviewRepository.save(review);
    
    return true;
}
```

### π“Β Review Entity

---

```java
@Entity
@Getter
@Setter
@AllArgsConstructor
@NoArgsConstructor
public class Review {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    private String content;
    @ManyToOne
    @JoinColumn(name = "bookId")  // μ™Έλν‚¤ μ΄λ¦„μ„ 'bookId'λ΅ μ„¤μ •
    private Book book;
}
```